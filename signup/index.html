<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0052FF">
<title>تسجيل الدخول مع قراءة QR - ZXing</title>
<style>
  :root{--blue:#0052ff;--ink:#0f172a;--muted:#5b6472;--line:#d5dbe5;--card:#ffffff}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Tahoma,Arial,sans-serif;background:#fff;color:var(--ink)}
  .shell{max-width:400px;margin:0 auto;padding:20px}
  .group{margin-bottom:16px}
  .label{display:block;margin-bottom:6px;font-weight:600}
  .field{width:100%;height:44px;border:1px solid var(--line);border-radius:6px;padding:0 10px;font-size:14px}
  .qr-box{border:1px solid var(--line);border-radius:10px;overflow:hidden;text-align:center;background:#f9f9f9;padding:10px}
  .qr-box img{max-width:100%;height:auto;display:block;margin:auto}
  .qr-result{margin-top:8px;font-size:13px;word-break:break-all}
  .qr-result a{color:var(--blue);text-decoration:none}
</style>
</head>
<body>

<div class="shell">
  <div class="group">
    <span class="label">اختر المنصة</span>
    <select id="platform" class="field">
      <option value="" selected disabled>اختر المنصة</option>
      <option>LINEBET</option>
      <option>1XBET</option>
      <option>MELBET</option>
      <option>MEGAPARI</option>
      <option>STAKE</option>
      <option>MYSTAKE</option>
      <option>GOOOBET</option>
      <option>RISCOBET</option>
      <option>888STARZ</option>
    </select>
  </div>

  <div id="idGroup" class="group">
    <span class="label">أدخل الـ ID</span>
    <input id="uid" class="field" type="text" placeholder="مثال: 1234567">
  </div>

  <div id="qrGroup" class="group" style="display:none;">
    <div class="qr-box">
      <img id="qrImage" src="" alt="QR Code">
    </div>
    <div id="qrOutput" class="qr-result"></div>
  </div>
</div>

<!-- مكتبة ZXing -->
<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
  const platform=document.getElementById('platform');
  const idGroup=document.getElementById('idGroup');
  const qrGroup=document.getElementById('qrGroup');
  const qrImage=document.getElementById('qrImage');
  const qrOutput=document.getElementById('qrOutput');

  const QR_MAP={
    STAKE:'https://i.postimg.cc/0QYFhNMS/stake-qr.png', // رابط QR Stake
    MYSTAKE:'https://i.postimg.cc/NF5nFwQ5/mystake-qr.png' // رابط QR MyStake
  };

  async function readQRCode(url){
    qrOutput.innerHTML='جارٍ قراءة الكود...';
    try{
      const img=await loadImage(url);
      const canvas=document.createElement('canvas');
      const ctx=canvas.getContext('2d');
      canvas.width=img.width;
      canvas.height=img.height;
      ctx.drawImage(img,0,0);
      const luminanceSource = new ZXing.BitmapLuminanceSource(ctx.getImageData(0,0,canvas.width,canvas.height));
      const binaryBitmap = new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));
      const reader = new ZXing.QRCodeReader();
      const result = reader.decode(binaryBitmap);
      qrOutput.innerHTML=`<a href="${result.getText()}" target="_blank">${result.getText()}</a>`;
    }catch(e){
      qrOutput.innerHTML='❌ لم يتم التعرف على أي كود QR';
    }
  }

  function loadImage(src){
    return new Promise((resolve,reject)=>{
      const img=new Image();
      img.crossOrigin="Anonymous";
      img.onload=()=>resolve(img);
      img.onerror=reject;
      img.src=src;
    });
  }

  platform.addEventListener('change',()=>{
    const value=platform.value;
    if(value==='STAKE'||value==='MYSTAKE'){
      idGroup.style.display='none';
      qrGroup.style.display='block';
      qrImage.src=QR_MAP[value];
      readQRCode(QR_MAP[value]);
    }else{
      idGroup.style.display='block';
      qrGroup.style.display='none';
    }
  });
</script>

</body>
</html>
